name: libndt

docker: bassosimone/mk-debian
docker_tc_disabled: true

amalgamate:
  libndt.hpp:
  - preamble.hpp
  - sys.hpp
  - api.hpp
  - impl.hpp

function_checks:
- name: strtonum
  define: LIBNDT_HAVE_STRTONUM

dependencies:
- github.com/adishavit/argh
- github.com/catchorg/catch2
- github.com/curl/curl
- github.com/measurement-kit/generic-assets
- github.com/nlohmann/json
- github.com/openssl/openssl

targets:
  executables:
    libndt-client:
      compile: [libndt-client.cpp api.hpp impl.hpp sys.hpp]
    libndt-standalone-builds:
      compile: [libndt-standalone-builds.cpp libndt.hpp]
    sys_test:
      compile: [sys_test.cpp api.hpp impl.hpp sys.hpp]
    tests-curl:
      compile: [curlx_test.cpp api.hpp impl.hpp sys.hpp]
    tests-libndt:
      compile: [libndt_test.cpp api.hpp impl.hpp sys.hpp]

tests:
  curl_unit_tests:
    command: tests-curl
  sys_unit_tests:
    command: sys_test
  other_unit_tests:
    command: tests-libndt
  simple_test:
    command: libndt-client -download -upload -verbose
  modern_test:
    command: libndt-client -ca-bundle-path .mkbuild/download/ca-bundle.pem
                           -verbose -download -upload -tls -json -websocket
